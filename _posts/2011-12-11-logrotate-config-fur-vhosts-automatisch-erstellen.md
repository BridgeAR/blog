---
title: Logrotate-Config für VHosts automatisch erstellen
author: Markus Tacker
layout: post
permalink: /logrotate-config-fur-vhosts-automatisch-erstellen
categories:
  - Snippets
---
Mit diesem Script erzeuge ich für alle Virtuellen-Hosts eines Apache2-Webservers eine Konfiguration für Logrotate.

Hierzu lese ich die VHost-Konfigurationen in `/data/sites` ein und parse daraus die Pfade zu den Logfiles.

Anschließend erzeuge ich mit Hilfe eines Templates die eigentliche Konfigurations-Datei im `logrotate.d`-Ordner.

**logrotate-config.sh**  
``<br />
#!/bin/bash</p>
<p>CONFDIR=/data/sites/<br />
TEMPLATE=/data/sites/logrotate.conf.template<br />
OUTFILE=/etc/logrotate.d/`hostname`-apache</p>
<p>echo "# DO NOT EDIT!" > $OUTFILE<br />
echo "# automatically generated by $0 on `date`" >> $OUTFILE<br />
echo "" >> $OUTFILE</p>
<p>for i in `cat $CONFDIR/*.conf | grep -i -E "(Transfer|Error|Custom)Log" | awk '{ print $2; }' | sort | uniq`<br />
do<br />
        echo -n "$i " >> $OUTFILE<br />
done;</p>
<p>echo $OUTFILE<br />
cat $TEMPLATE >> $OUTFILE<br />
cat $OUTFILE<br />
``

**/data/sites/logrotate.conf.template**  
`<br />
{<br />
  missingok<br />
  notifempty<br />
  sharedscripts<br />
  postrotate<br />
  /etc/init.d/apache2 reload > /dev/null 2>&#038;1 || true<br />
  endscript<br />
  rotate 9999999<br />
}<br />
`